#### Tool for attack simulations on coreLang attackgraphs generated by mal-toolbox.
This is an interactive tool for running attack simulations on the mal-toolbox-generated attack graphs.
The mal-toolbox repository is found at https://github.com/mal-lang/mal-toolbox/.

#### Installation
Clone this repository:
```sh
git clone https://github.com/beatajoh/mgg-project
```
#### Virtual environment
Set up a virtual environment with all necessary dependencies

```sh
python -m venv env
source env/bin/activate
pip install mal-toolbox
pip install py2neo
```
**Note:** You need a Python version >= 3.9, the latest the better.

#### Set up the Neo4j database
We need an open Neo4j instance running with a database
with the following credentials:

- username: neo4j
- password: mgg12345!
- dbname:   neo4j

Note that the Neo4j project name and the DBMS name used within
the project are irrelevant, the most important thing is that
the password matches as the username and specific database
name are set to default values.

#### Usage
Open the terminal, navigate to the mgg-poject directory "interface", and run:
````
python main.py
````

#### What do the attack simulations do?
* **Step by step attack** - Simulate the attack path from the attacker node by manually choosing which nodes to move forward to.
* **Shortest path Dijkstra** - Get the shortest path from the attacker node to a target attack step.
* **Random path** - Get a random path of attack steps. It is possible to search for a target attack step and adding a cost budget for the attacker. It is also possible to just specify the target or only use an attack budget without a target. 
* **BFS** - Get a subgraph where all nodes are within the cost budget of the attacker in all directions. Note that the attack step type is not considered.

#### Example to get started
1. Activate the venv.
2. Run the interface with ````python main.py````.
3. Now you can choose the *step-by-step* attack option, or any of the graph algorithms.
4. Open the main.py file and look at the comments where some example targets are suggested.
5. Note: The attacker and its entry points for all simulations are fixed in the code and this will be necessary to modify later.

#### Tests
The file *test.py* contains tests for Dijkstra and Random path. Run the test file with ````python test.py````.

#### Some test cases for the provided model.json
- Make sure that the predefined cost file is used, by setting attack_simulation.use_ttc = False.
- Set the start node to "Attacker:12:firstSteps".
- Ensure that the attacker has the entry points: "Credentials:5:attemptCredentialsReuse", "Credentials:8:attemptCredentialsReuse", "Credentials:6:attemptCredentialsReuse", "Credentials:6:guessCredentials", "Application:0:softwareProductAbuse".

**Shortest path with Dijkstra**
- target_node_id: "Credentials:6:attemptCredentialsReuse". cost: 4.

Now also add "Application:0:attemptFullAccessFromSupplyChainCompromise" as an attacker entry point for the rest of the test cases.

- target_node_id: "Application:0:fullAccess". cost: 9+3+4+2+1=19.

- target_node_id: "Application:0:attemptApplicationRespondConnectThroughData". cost: 9+3+4+2+1+3=22.

- target_node_id:"Application:0:attemptModify". cost: 9+3+4+2+1+10=29.

- target_node_id: "Credentials:9:propagateOneCredentialCompromised". cost: 79.

- target_node_id: "Credentials:5:extract". This node is not reachable, so it should not be in the visited set.

**Random path**

- It should be able to find Application:0:bypassSupplyChainAuditing without a budget.

- It shoulde be able to find Application:0:fullAccessFromSupplyChainCompromise, without a budget or a very large budget like 10000. But this will be more expensive compared to the previous case since we have an 'and' step in the path. if you set the budget to 10, then the target is not found.

- It should be able to find Application:0:attemptModify without a budget. But this will be more expensive compared to the previous case since we add a couple of 'or' steps.

** TTC **
To use Time-To-Comprimse, instanciate AttackSimulation object with use_TTC=True.

#### TODO
* Use mal-toolbox calculation of the attack surface.

